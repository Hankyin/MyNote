[TOC]

# 概论

颜色由红绿蓝三色合成

颜色深度：每个像素所占的二进制位数，颜色深度越大所能表示的颜色数目越多。



# 图像存储格式

## 黑白图像

二值图像，1位

灰度图像：8位

## 8位索引图像

除了图像，还有一个颜色的索引表。

图片中的像素值对应颜色索引表中一个具体的rgb值，最多256色

当索引表中的rgb分量相等时，就会形成灰度图像。

## 真彩色

真彩色的颜色深度是24位，rgb三通道各用一个字节

# BMP格式

1. 位图文件头BITMAPFILEHEADER

   含有BMP文件类型，文件大小和位图起始位置

   ```c
   typedef struct tagBITMAPFILEHEADER
   {
       WORD bfType;//位图文件的类型，必须为BM(1-2字节）
       DWORD bfSize;//位图文件的大小，以字节为单位（3-6字节，低位在前）
       WORD bfReserved1;//位图文件保留字，必须为0(7-8字节）
       WORD bfReserved2;//位图文件保留字，必须为0(9-10字节）
       DWORD bfOffBits;//位图数据的起始位置，以相对于位图（11-14字节，低位在前）
       //文件头的偏移量表示，以字节为单位
   }__attribute__((packed)) BITMAPFILEHEADER;
   ```

2. 位图信息头BITMAPINFOHEADER

   BMP位图信息头数据用于说明位图的尺寸等信息。

   ```c
   typedef struct tagBITMAPINFOHEADER{
   DWORD biSize;//本结构所占用字节数（15-18字节）
   LONG biWidth;//位图的宽度，以像素为单位（19-22字节）
   LONG biHeight;//位图的高度，以像素为单位（23-26字节）
   WORD biPlanes;//目标设备的级别，必须为1(27-28字节）
   WORD biBitCount;//每个像素所需的位数，必须是1（双色），（29-30字节）
   //4(16色），8(256色）16(高彩色)或24（真彩色）之一
   DWORD biCompression;//位图压缩类型，必须是0（不压缩），（31-34字节）
   //1(BI_RLE8压缩类型）或2(BI_RLE4压缩类型）之一
   DWORD biSizeImage;//位图的大小(其中包含了为了补齐行数是4的倍数而添加的空字节)，以字节为单位（35-38字节）
   LONG biXPelsPerMeter;//位图水平分辨率，每米像素数（39-42字节）
   LONG biYPelsPerMeter;//位图垂直分辨率，每米像素数（43-46字节)
   DWORD biClrUsed;//位图实际使用的颜色表中的颜色数（47-50字节）
   DWORD biClrImportant;//位图显示过程中重要的颜色数（51-54字节）
   }__attribute__((packed)) BITMAPINFOHEADER;
   ```

3. 位图颜色表RGBQUAD

   颜色表用于说明位图中的颜色，它有若干个表项，每一个表项是一个RGBQUAD类型的结构，定义一种颜色。

   ```c
   typedef struct tagRGBQUAD{
   BYTE rgbBlue;//蓝色的亮度（值范围为0-255)
   BYTE rgbGreen;//绿色的亮度（值范围为0-255)
   BYTE rgbRed;//红色的亮度（值范围为0-255)
   BYTE rgbReserved;//保留，必须为0
   }__attribute__((packed)) RGBQUAD;
   ```

# 图像处理编程基础

常用图像处理工具

opencv，cximage，matlab，cimg, freeimage,halcon,

开源项目

openbr 开源人脸识别,easypr开源车牌识别



## 图像的显示

扫描显示，

渐显渐隐，将rgb值除以一个数可以让图片变淡。

马赛克显示，将图片分割成小块，然后随机显示小块

# 几何变换

原图 * 变换矩阵 = 目标图

齐次坐标：将原本是n维的向量用一个n+1维的向量表示。它可以实现多种几何变换的统一。

齐次坐标的几何意义：把二维的点投影到三维空间中

平移变换矩阵 ：
$$
T = \left[
    \begin{matrix}
    1 & 0 & \Delta x \\
    0 & 1 & \Delta y \\
    0 & 0 & 1
    \end{matrix}
\right]
$$
缩放变换矩阵：
$$
S = \left[
    \begin{matrix}
    S_x & 0 & 0 \\
    0 & S_y & 0 \\
    0 & 0 & 1
    \end{matrix}
\right]
$$

旋转变换矩阵：
$$
R = \left[
    \begin{matrix}
    cos(r) & sin(r) & 0 \\
    -sin(r) & cos(r) & 0 \\
    0 & 0 & 1
    \end{matrix}
\right]
$$

水平镜像：
$$
M = \left[
    \begin{matrix}
    -1 & 0 & fWidth \\
    0 & 1 & 0 \\
    0 & 0 & 1
    \end{matrix}
\right]
$$
垂直镜像：
$$
M = \left[
    \begin{matrix}
    1 & 0 & 0 \\
    0 & -1 & fHeight \\
    0 & 0 & 1
    \end{matrix}
\right]
$$
复合变换可以多个变换矩阵相乘，但是注意不满足交换律。

# 图像增强

增强图像中的有用信息，它可以是一个  **失真** 的过程，其目的是要改善图像的视觉效果，针对给定图像的应用场合。

有目的地强调图像的整体或局部特性，将原来不清晰的图像变得清晰或强调某些感兴趣的特征，扩大图像中不同物体[特征](https://baike.baidu.com/item/%E7%89%B9%E5%BE%81/6205236)之间的差别，抑制不感兴趣的特征，使之改善图像质量、丰富信息量，加强图像判读和识别效果，满足某些特殊分析的需要。

## 灰度变换

### 直接灰度变换

遍历图片中所有的点，通过一定的数学变换把该点的灰度值修改为特定的值。

#### 线性变换

y = k * x + b

线性变换是最简单的变换规则。将指定点的灰度值作为x输入公式，返回的y值作为新的灰度值。

#### 分段变换

修改某个特定区间内的像素，比如像素二值化。

#### 非线性变换

指数变换，对数变换，使用一些非线性的函数来修改像素。

各种类型的变换只是使用了不同的变换函数。

### 直方图

直方图是一个图表。横坐标为某幅图像的灰度级别（一般为0-255），纵坐标为图像中具有某种灰度级的像素的个数。

特性：将一张图片分割为若干份，每份的直方图之和与整体图片的直方图相等。

在计算机编程中，直方图通常用一个数组表示，数组的下标为灰度级，数组中的每个元素的值为该灰度级出现的像素的个数。

#### 直方图均衡化

图片中的像素的灰度值不太可能是均衡分布的，比如较亮的图片中灰度值大的像素占比很高，较暗的图片中灰度值小的像素占比很高。这样图片的整体对比度较低，图片质量较差。

直方图均衡化的基本思想就是：

**把原始图的直方图变换为均匀分 布的形式，这样就增加了像素灰度值的动态 范围，从而达到增强图像整体对比度的效果**

算法：

1. 统计直方图数组，用一个数组p记录
2. 申请数组s，令s[i] = s[i-1] + p[i]
3. 申请数组l，令l[i] = s[i] * 255 （假设灰度级为255）
4. 遍历所有像素，以像素的灰度值为i，从数组l中找到新的灰度值。

## 图像平滑

目的：

1. 模糊，去除太小的细节或将小间断联系起来。
2. 消除噪声。噪声的特点是空间不相关，与邻近像素显著不同。

平滑操作也是在修改某个像素的灰度值，只是修改后的像素值受周围像素的影响。

### 邻域平均法

某个像素点的由周围几个像素点的均值决定。如果该像素点的灰度值与周围像素点的均值之差小于某个阈值，不改变该点灰度，如果大于，修改该点灰度为邻域灰度均值。

模板：

一个n×n的小矩阵，用来决定影响像素点的邻域大小。比如3×3的模板，中心元素为需要修改的像素，该像素周围的8个像素为其邻域，影响他的取值。

图像卷积：

将模板在图片上滑动，将图像上的点的像素灰度值与模板上的对应数值相乘，然后将然后将所有相乘后的值相加作为模板中间像素对应的图像上像素的灰度值，并最终滑动完所有图像的过程。

邻域平均法的改进：

变换领域的大小，形状和方向。

给邻域像素添加权重，使用加权平均法。

常用模板：

高斯模板： 
$$
\left[
\begin{matrix}
    1 & 2 & 1 \\
    2 & 4 & 2 \\
    1 & 2 & 1
    \end{matrix}
 \right]
$$

自适应模板：

自适应模板不是一个模板，是一系列模板的组合，每计算一个点时，分别计算各个模板内灰度值的方差，采用方差最小的那个模板进行计算。这样可以适应有边缘的区域，降低对边缘的模糊。

模板不一定是矩形，也可以是十字，斜线，左半边，右半边等。

### 中值滤波

使用一个模板在图像上滑动，将模板对应的点的灰度值从大到小排列，找出其中值作为模板中间的点的像素值。

克服了领域平均法中模糊边界的问题。